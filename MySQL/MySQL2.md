# 参考文章

- [整体类：掘金 贾不假](https://juejin.cn/post/6850037271233331208#heading-76)

# 整体性问题

- Conception：
  1. 架构：客户端、连接器、查询缓存、分析器、优化器、执行器、存储引擎
  
- Question：
  1. **一条查询语句是怎么执行的？/MySQL架构？**
  
     - 客户端：与连接器建立连接
     - 连接器：查询缓存，命中则返回，没有进入分析器
     - 查询缓存
     - 分析器：分析sql语义
     - 优化器：优化sql语句，选择索引、join表的连接顺序
     - 执行器：权限验证，通过则执行sql
     - 存储引擎：存储数据
  
  2. **一条更新语句是怎么执行的？（两阶段提交）**
  
     - ```sql
       update T set c=c+1 where id=2;
       ```
  
     - 查找id=2，加载到缓存中
  
     - 将c+1并写进数据库，再更新到内存
  
     - 写入redolog（prepare状态）
  
     - 生成binlog，把binlog写入磁盘
  
     - 提交事务，redolog改为commit状态
  
     - 更新完成
  
     - 为什么两阶段提交：数据库的状态（redolog）和用它的日志（binlog）恢复出来的库的状态不一致

# 基础/语法问题

- Conception：
  1. 数据库三范式
  2. char和varchar
  3. drop、delete、truncate
  3. 存储过程
  4. 巴斯-科德范式（BCNF第三范式的子集）、第四范式(4NF）和第五范式（5NF，又称完美范式）
- Question：
  1. **说说三范式？**
     - 第一范式：数据库中的字段具有原子性，不可再分（原子性，否则就不是关系数据库）
     - 第二范式：有主键，非关键字段依赖主键（唯一性，一个表只说明一个事务）
     - 第三范式：非主键字段不能相互依赖（不存在传递关系）
     - 并不是所有的表一定要满足三大范式
  1. char和varchar区别？
  1. varchar为什么建议不超过255？
  1. drop、delete、truncate区别？
  1. in和exists区别
  1. 说说存储过程？

# 引擎

- Conception：
  1. InnoDB、MyISAM、Memory
  
- Question：
  1. 存储引擎对比？
  
     |          | InnoDB                                               | MyISAM                                                       |      |
     | -------- | ---------------------------------------------------- | ------------------------------------------------------------ | ---- |
     | 事务     | 支持事务                                             | 不支持事务                                                   |      |
     | 外键     | 支持外键                                             | 不支持外键                                                   |      |
     | 索引     | 是聚簇索引，B+tree为索引结构，数据文件和索引绑在一起 | 非聚簇索引，B+tree为索引结构，索引和数据文件分离，索引保存的是数据文件的指针 |      |
     | 文件组成 | frm：表定义文件；idb：数据文件                       | frm：表定义文件；myd：数据文件；myi：索引文件                |      |
     | 锁       | 表、行锁                                             | 表锁                                                         |      |
     | 主键     | 必须有主键，如果每指定会自己生成默认主键             | 可以没有                                                     |      |
     | 日志     | redolog                                              | 没有redolog                                                  |      |
     | 行数     | 不保存具体行数                                       | 一个变量保存了整个表的行数                                   |      |
  
  1. 可以混合使用存储引擎吗？

# 索引

- Conception：

  1. **数据结构角度：**
  1. B+树索引、Full-Text全文索引、哈希索引、R-Tree索引
  2. **物理存储角度：**
  3. 聚簇索引、非聚簇索引（辅助索引、二级索引）
  4. **逻辑角度**：
  5. 唯一索引
  6. 普通索引
  7. 主键索引
  8. 单值索引、单列索引
  9. 联合索引、复合索引、多列索引
  10. 覆盖索引：查询语句的结果从索引中就可以取得，不需要回表
  11. 冗余索引、重复索引
  12. **一些规则：**
  13. 最左前缀原则
  13. 索引下推
  14. **不太常见：**
  15. 倒排索引、反向索引
  16. 倒序索引
  17. 前缀索引
  18. 空间索引

- Question：

  1. 索引是什么？为什么要有索引？
  
     - 字典中的目录，提交查询效率
     - 
  
  2. 索引的底层实现？索引为什么用B+树？
  
     - B+树只有叶子节点存数据，内部节点不存指向数据的指针，内存节点更小，磁盘能容纳的关键字数量越多，IO读写次数少
     - ![img](https://upload-images.jianshu.io/upload_images/16722260-c46915a0c91a4757.png)
     - 方便扫库，只扫描一次叶子节点即可，更适合范围查询；B树的话需要进行中序遍历
  
  3. 索引的优缺点？
  
  4. 如何创建索引？
  
  5. 创建索引时候需要注意什么？
  
  6. 创建索引的原则
  
  7. 索引分类？
  
  8. **普通索引和唯一索引怎么选择？**
  
     - 普通索引：插入场景（）
     - 唯一索引：查询场景（扫整张表，查到即返回）
  
  9. **什么是回表？**
  
     - 先通过非主键索引找到主键id，再通过主键从主键索引里取出数据
  
  10. 聚簇索引和非聚簇索引？非索引一定会回表吗？
  
  11. 联合索引？为什么注意联合索引的顺序？
  
  12. **说说最左覆盖原则？**
  
      - 最左面的一个列不触发，之后的索引都无法触发
  
      - ```sql
        # 存在(a,b,c)的索引
        #a,b走索引
        where a = 1 and b = 1 
        #b没触发，c也不走索引
        where a = 1 and c = 1
        #a没触发，b,c都不走索引
        where b = 1 and c = 1
        ```
  
  13. **说说索引下推？**
  
      - ```sql
        # 有(name,age)的联合索引
        select * from userinfo where name like "ming%" and age=20;
        ```
  
      - 5.6之前返回name符合的结果，拿着id值再去回表查询
  
      - 5.6开始索引内部判断age是否为20
  
      - 减少了回表次数
  
      - 索引下推InnDB引擎只适用于二级索引/非主键索引（聚簇索引会将整行数据读到缓冲区，索引下推减少IO次数就失去了意义，数据已经在内存中，不用再去读取了）
  
      - 索引下推InnDB引擎只适用于二级索引（聚簇索引会将整行数据读到缓冲区，索引下推减少IO次数就失去了意义，数据已经在内存中，不用再去读取了）
  
  14. 怎么查看有没有用到索引？
  
  15. 怎么查看有没有用到索引？
  
  16. 为什么推荐使用自增长主键作为索引？为什么推荐使用自增id作为主键？
  
  17. 使用索引一定能提高查询性能吗？
  
  18. **什么时候索引失效？**
  
      - 最左前缀法则
      - 不要在索引上做任何操作（计算、函数、自动/手动类型转换），不然会导致索引失效而转向全表扫描
      - 索引中存在范围条件（between、>、<、in）
      - 判断条件（!=、>、<）
      - 索引字段上使用 is null / is not null 判断
      - 索引字段使用like以通配符**开头**（‘%字符串’）
      - 索引字段是字符串，但查询时不加单引号
      - 索引字段使用 or
  
  19. 什么时候不走索引？

# 事务

- Conception：
  1. 四个特性（ACID）
  2. 并发事务访问相同记录的情况（读读，读写写读，写写）
  3. 脏写脏读、不可重复读、幻读
  4. 4个隔离级别
  5. MVCC
  6. 当前读、快照读
- Question：
  1. 事务是什么？事务的四个特性？
  1. 事务四种隔离级别和三种读的问题解决了哪些？
  1. 说说脏读、不可重复读、幻读？
  1. 说说MVCC？有什么作用？
  1. 事务的实现原理？（JAVAguide）
  1. 可重复读解决幻读了吗？

# 日志

- Conception：
  1. Write Ahead Loging技术
  2. 逻辑日志、物理日志
  3. redolog
  4. undolog
  5. binlog
  6. relay log、slow query log、error log
  7. gereral log
  7. 两阶段提交
- Question：
  1. **WAL是什么？有什么好处？**
     - Write-Ahead Logging：所有的修改都先被写入到日志（log）中，然后再写磁盘。如果事务失败，WAL中的记录会被忽略，如果成功，某个时间点写回到数据库文件，提交修改。
     - 保证原子性、持久性
     - 好处：读写可以并发执行，不会相互阻塞（写写依旧阻塞）；先写log再写磁盘，随机写变为数据写，IO次数降低；可以用日志恢复磁盘数据
  2. redolog是什么？binlog是什么？undolog是什么？relaylog是什么？
  3. redolog和binlog的区别
  4. Innodb事务为什么要两阶段提交？
  5. MySQL事务日志说一下？

# 锁

- Conception：
  1. 粒度分：
  2. 全局锁（FTWRL Flush tables with read lock）
  3. 表锁（表锁、MDL、意向锁、AUTO-INC锁）
  4. 行锁（Record Lock记录锁、Gap Lock间隙锁、Next-key Lock临键锁）
  5. 属性分：
  6. 读锁|共享锁、写锁|排他锁
  7. 状态分：
  8. 意向共享锁 意向排他锁
  8. 死锁
  8. 乐观锁、悲观锁
- Question：
  1. 锁的分类？
  1. 为什么加锁？
  1. 说说每个锁
  1. 死锁？
  1. 隔离级别与锁的关系？
  1. 优化锁的意见？

# 键

- Conception：
  1. 超键、候选键、主键、外键
- Question：
  1. 说说超键、候选键、主键、外键？
  2. **为什么推荐使用自增 id 作为主键？**
     - 普通索引的B+树上叶子节点存的是主键索引的值，会导致索引文件存储空间大
     - 自增id新增时直接插入到页尾，顺序插入即可，减少页分裂维护的成本

# 分区分库分表

- Conception：
  1. 分区
  2. 分表（垂直拆分、水平拆分）
  3. 分库（主从）

# 主从复制（同步）

- Conception：
  1. 主从复制
  2. 读写分离
  3. 主从延迟
- Question：
  1. 主从如何同步数据？（讲讲那个图）
  2. 主从复制涉及到哪三个线程？
  3. 主从延迟原因？怎么解决？
  4. 主从同步目的，为什么要主从同步？
  4. 如何实现读写分离？

# 问题

- Question：
  1. 为什么一条sql语句查询一直慢？
  1. 为什么一条sql语句查询偶尔慢？
  1. 删除数据表大小没变？（45讲13讲）
  1. 为什么不要使用长事务
  1. 数据库CPU飙升到500%怎么处理？
  1. 查询性能的优化方法？

# 优化

- Question：
  1. 说说sql调优思路

# 一些我暂时不知道放在哪的点

- buffer pool（moon聊技术34）

# 其他问题/概念

- [DDL, DML, DCL, TCL](https://www.cnblogs.com/heyonggang/p/9284271.html)
- [T-SQL](https://blog.csdn.net/weixin_37519752/article/details/80913773?spm=1001.2101.3001.6650.3&utm_medium=distribute.wap_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-3.wap_blog_relevant_default&depth_1-utm_source=distribute.wap_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-3.wap_blog_relevant_default)

# 遗留问题

- 一致性读 READVIEW
- [分布式事务（moon聊技术31）](https://mp.weixin.qq.com/s/q3MsMDtqrUGDfnggAF8-RQ)
- SQL约束（javaguide4）
- 可重复读级别下通关Next-key Lock解决幻读？

